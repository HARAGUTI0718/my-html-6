<!DOCTYPE html>
<html lang="ja" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ナカソネ住設の強み - 社員向けハンドブック（リライト版）</title>
  
  <!-- Webフォント参照を削除（オフライン対応） -->

  <style>
    :root{
      --primary:#1e40af; /* ネイビーブルー */
      --accent:#2563eb;  /* コバルト */
      --ok:#10b981;      /* グリーン */
      --warn:#ea580c;    /* オレンジ */
      --bg:#f8fafc;      /* 明るいグレー */
      --ink:#1f2937;     /* 文字色 */
      --muted:#6b7280;   /* 補助文字 */
      --hot:#0ea5e9;     /* ほっと色 */
      --zutto:#16a34a;   /* ずっと色 */
      --waku:#f59e0b;    /* わくわく色 */
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:0; color:var(--ink); background:#fff;
      font-family:'Noto Sans JP',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
      line-height:1.6; font-size:16px;
     font-size:17px;}
    .container{max-width:768px;margin:0 auto;padding:24px 20px 80px}
    header.cover{position:sticky;top:0;background:#fff;border-bottom:2px solid var(--accent);z-index:10;text-align:center;}
    .cover-inner{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px 4px;text-align:center;}
    .logo{width:120px;height:auto;display:block;border-radius:0;}
    h1{font-size:34px;margin:0;color:var(--primary);line-height:1.22}
    .cover h1{text-align:center} h2{font-size:28px;font-weight:800;margin:24px 0 12px;color:var(--primary)} h3{font-size:22px;font-weight:700;margin:20px 0 10px;color:#0f172a} .lead{font-weight:700;margin:2px 0 8px;padding-left:15px;font-size:24px;} 
    .sub{text-align:center; font-size:14px;color:var(--muted)}

    nav.toc{margin:16px 0 24px;background:var(--bg);border:1px solid #e5e7eb;border-radius:14px;padding:12px}
    .toc h2{font-size:28px;font-weight:800;margin:24px 0 12px;color:var(--primary)}
    .toc a{display:block;padding:14px 14px;border-radius:10px;text-decoration:none;color:var(--ink);font-weight:700;font-size:18px;border-bottom:1px solid #d1d5db} .toc a:last-child{border-bottom:none}
    .toc a:hover{background:#eef2ff}

    section{margin:28px 0}
    section>h1{font-size:26px;margin:0 0 14px;padding:14px 16px;border-radius:12px;background:var(--primary);color:#fff;box-shadow:0 2px 0 rgba(0,0,0,.06)} 

    /* 第1章：3バリュー */
    .value-card{border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;margin:16px 0;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,0.08);} 
    .value-head{display:flex;align-items:center;justify-content:flex-start;gap:10px;padding:4px 8px;text-align:left;border-radius:8px;}
    .value-head .dot{width:20px;height:20px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;}
    .value-head h3{font-size:22px;font-weight:700;margin:12px 0;color:#0f172a;} .value-head h2{font-size:28px;font-weight:800;margin:12px 0;color:var(--primary)}
    .value-body{padding:0 16px 14px; font-size:17px;}
    .lead{font-weight:700;margin:2px 0 8px;padding-left:15px;font-size:24px;}
    .points{display:grid;grid-template-columns:1fr;gap:6px;margin:8px 0}
    .point{display:flex;gap:8px;align-items:flex-start;background:#f9fafb;border:1px solid #edf2f7;padding:10px;border-radius:10px}
    .point .mark{font-weight:700;min-width:1.5em;text-align:center}
    .benefit{border:1px solid #d1fae5;border-left:6px solid var(--ok);border-radius:12px;padding:14px 14px;margin-top:10px}
    .benefit strong{display:block;margin-bottom:6px}
    /* ベネフィット配色バリエーションと文字強調 */
    .benefit>div{font-size:18px;font-weight:800}
    .benefit.hot{background:#e6f7fd;border-color:#bae6fd;border-left-color:var(--hot);}
    .benefit.zutto{background:#eaf7ee;border-color:#cdeccd;border-left-color:var(--zutto)}
    .benefit.waku{background:#fff6e5;border-color:#fee8c8;border-left-color:var(--waku)}

    .dot.hot{background:var(--hot);}
    .dot.zutto{background:var(--zutto)}
    .dot.waku{background:var(--waku)}

    /* 第3章：行動指針カード */
    .action-grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:768px){.action-grid{grid-template-columns:1fr;gap:14px}}
    .action{border:1px solid #e5e7eb;border-radius:14px;padding:12px;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,0.08); min-height:100%;} 
    .action h4{margin:0 0 6px;font-size:20px;font-weight:700;color:var(--primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .badge{display:inline-block;margin-right:6px;padding:3px 10px;border-radius:999px;font-size:13px;border:1px solid #e5e7eb;background:#f9fafb}
    .talk{background:#eef2ff;border:1px solid #e0e7ff;border-radius:10px;padding:10px;margin-top:8px}
    .ng{background:#fff1f2;border:1px solid #ffe4e6;border-radius:10px;padding:10px;margin-top:6px}
    .mind{font-size:18px;font-weight:700;color:#1e293b;margin-top:10px;display:flex;gap:6px;align-items:flex-start;}

    /* 第2章：お客様タイプと接し方 */
    .type-grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:768px){.type-grid{grid-template-columns:1fr;gap:14px}}
    .ctype{border:1px solid #e5e7eb;border-radius:14px;padding:12px;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,0.08); min-height:100%;} 
    .ctype h4{margin:0 0 6px;font-size:20px;font-weight:700;color:#0f172a;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .ctype h4{margin:0 0 6px;font-size:20px;font-weight:700;color:#0f172a;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .keys{display:grid;gap:6px;margin-top:6px;padding-left:0;margin-left:0}
    .keys li{background:#f9fafb;border:1px solid #edf2f7;padding:8px;border-radius:8px;list-style:none}
    .axis{background:#ecfeff;border:1px solid #cffafe;border-left:6px solid var(--hot);border-radius:10px;padding:10px;margin-top:8px}

    /* フッター */
    footer{margin-top:32px;color:var(--muted);font-size:12px;text-align:center}

    /* アクセシビリティ・タップ領域 */
    button, a{touch-action:manipulation}
    .hit{padding:8px 0}
    /* アイコン画像共通 */
    .ico{width:18px;height:18px;vertical-align:-3px;margin-right:6px;filter:grayscale(100%) contrast(120%)}
    @media(min-width:760px){.ico{width:20px;height:20px;vertical-align:-4px}}
  
  
    /* ==== 追加: 目次アコーディオン & アプリ風ナビ & 検索 ==== */
    html { scroll-behavior: smooth; }
    [id] { scroll-margin-top: 90px; } /* スティッキーヘッダ分の余白 */

    nav.toc {
      margin: 16px 0 24px;
      background: var(--bg);
      border: 1px solid #e5e7eb;
      border-radius: 14px;
      padding: 12px 12px 16px;
    }
    nav.toc h2 {
      font-size: 24px;
      margin: 0 0 8px;
    }

    .quickbar {
      display: flex;
      gap: 8px;
      align-items: center;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 8px 10px;
      margin: 4px 0 8px;
    }
    .quickbar input{
      flex: 1;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 14px;
    }
    .quickbar .hint{
      font-size: 11px;
      color: var(--muted);
      white-space: nowrap;
    }

    .toc-subtitle{
      font-size: 12px;
      color: var(--muted);
      padding: 4px 2px 0 2px;
    }

    .toc details{
      border-radius: 10px;
      background: #f9fafb;
      margin-top: 8px;
      border: 1px solid #e5e7eb;
    }
    .toc details summary{
      cursor: pointer;
      padding: 8px 10px;
      font-weight: 700;
      list-style: none;
    }
    .toc details summary::-webkit-details-marker{
      display:none;
    }
    .toc .toc-list{
      margin: 0;
      padding: 4px 0 4px;
    }
    .toc .toc-list a{
      display:block;
      padding: 8px 12px;
      font-size: 14px;
      text-decoration:none;
      color: var(--ink);
      border-top: 1px dashed #e5e7eb;
    }
    .toc .toc-list a:first-child{
      border-top: none;
    }
    .toc .toc-list a:hover{
      background:#eef2ff;
    }

    .is-hidden{
      display:none !important;
    }

    /* 画面下のアプリ風ドックナビゲーション */
    .dock{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 10px;
      width: min(760px, 94vw);
      background: #0f172a;
      color: #fff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(15,23,42,0.5);
      z-index: 50;
    }
    .dock-inner{
      display:flex;
      gap:8px;
      padding:8px 10px;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
    }
    .dock a.btn{
      flex:1;
      min-width:100px;
      background: rgba(255,255,255,0.06);
      border-radius: 999px;
      padding: 8px 10px;
      border: 1px solid rgba(148,163,184,0.9);
      color:#fff;
      font-size:14px;
      font-weight:700;
      text-align:center;
      text-decoration:none;
    }
    .dock a.btn.to-top{
      flex:0 0 auto;
      min-width:70px;
    }
    @media (max-width:480px){
      .dock-inner{
        gap:6px;
        padding:8px 8px;
      }
      .dock a.btn{
        font-size:13px;
        padding:7px 8px;
      }
    }

  </style>
</head>
<body>
  <header class="cover">
    <div class="container cover-inner">
      
      <div>
        <h1>ナカソネ住設の強み｜社員向けハンドブック</h1>
        <div class="sub">現場で“そのまま使える”要点整理（タブレット最適化）</div>
      </div>
    </div>
  </header>

  <div class="container">
    
    <nav class="toc" aria-label="目次">
      <h2>目次</h2>
      <div class="quickbar" role="search">
        <input id="quickSearch" type="search" inputmode="search"
               placeholder="キーワードで絞り込み（例：緊急／高齢／ネット比較）"
               aria-label="カードを検索">
        <span class="hint">入力でカード一覧をフィルタ</span>
      </div>
      <details open>
        <summary>第1章　ナカソネの強み</summary>
        <div class="toc-subtitle">3バリュー</div>
        <div class="toc-list" id="toc-ch1"></div>
      </details>
      <details>
        <summary>第2章　強みを活かす行動</summary>
        <div class="toc-subtitle">行動カード</div>
        <div class="toc-list" id="toc-ch2"></div>
      </details>
      <details>
        <summary>第3章　お客様のタイプと接し方</summary>
        <div class="toc-subtitle">タイプ別カード</div>
        <div class="toc-list" id="toc-ch3"></div>
      </details>
    </nav>


    <!-- 第1章 -->
    <section id="ch1">
      <h1>第1章　ナカソネの強み</h1>

      <!-- ほっと -->
      <article class="value-card" aria-labelledby="v-hot">
        <div class="value-head" style="background:#e6f7fd;border-radius:8px;">
          <span class="dot hot" aria-hidden="true"></span>
          <h2 id="v-hot">ほっと（安心）</h2>
        </div>
        <div class="value-body">
          <h2 class="lead">誠実で、頼れて、すぐ動く。</h2>
          <div class="points">
            <div class="point"><span class="mark">・</span><div>困った時に<strong>すぐ駆けつけられる</strong></div></div>
            <div class="point"><span class="mark">・</span><div>その場で<strong>正確に説明</strong>できる</div></div>
            <div class="point"><span class="mark">・</span><div><strong>嘘がなく正直</strong>に向き合う</div></div>
          </div>
          <div class="benefit hot">
            <strong>▶ お客様にとっての「価値」</strong>
            <div>「この人に任せれば大丈夫」と思える</div>
          </div>
        </div>
      </article>

      <!-- ずっと -->
      <article class="value-card" aria-labelledby="v-zutto">
        <div class="value-head" style="background:#eaf7ee;border-radius:8px;">
          <span class="dot zutto" aria-hidden="true"></span>
          <h2 id="v-zutto">ずっと（継続）</h2>
        </div>
        <div class="value-body">
          <h2 class="lead">一度きりではなく、暮らしに長く寄り添う。</h2>
          <div class="points">
            <div class="point"><span class="mark">・</span><div><strong>修理から</strong>始まる長いお付き合い</div></div>
            <div class="point"><span class="mark">・</span><div>施工後も<strong>気にかける</strong></div></div>
            <div class="point"><span class="mark">・</span><div>追加費用やトラブルが出ないよう<strong>事前に確認</strong></div></div>
          </div>
          <div class="benefit zutto">
            <strong>▶ お客様にとっての「価値」</strong>
            <div>「次もお願いしたい」「また来てほしい」</div>
          </div>
        </div>
      </article>

      <!-- わくわく -->
      <article class="value-card" aria-labelledby="v-waku">
        <div class="value-head" style="background:#fff6e5;border-radius:8px;">
          <span class="dot waku" aria-hidden="true"></span>
          <h2 id="v-waku">わくわく（躍動）</h2>
        </div>
        <div class="value-body">
          <h2 class="lead">暮らしの未来を一緒に考え、より良い選択を支える。</h2>
          <div class="points">
            <div class="point"><span class="mark">・</span><div>実物を<strong>一緒に確かめる</strong>（ショールーム）</div></div>
            <div class="point"><span class="mark">・</span><div><strong>専門知識</strong>で不安を希望に変える</div></div>
            <div class="point"><span class="mark">・</span><div>10年後も『よかった』と思える提案</div></div>
          </div>
          <div class="benefit waku">
            <strong>▶ お客様にとっての「価値」</strong>
            <div>「良い選択ができた」「未来が楽しみになる」</div>
          </div>
        </div>
      </article>
    </section>

    <!-- 第2章：行動 -->
    <section id="ch2">
      <h1>第2章　強みを活かす行動</h1>
      <div class="action-grid">

        <div class="action">
          <h4> ネット比較歓迎、自社の価値を伝える <span class="badge">ずっと</span></h4>
          <ul>
            <li>お客様の調べた情報を否定しない</li>
            <li>“違い”を丁寧に言語化（例：製品機能、製品相性など）</li>
            <li>判断軸を提示（価格、保証、故障時対応スピード、施工品質など）</li>
          </ul>
          <div class="talk"><strong>一言トーク例：</strong><br>「ネットは価格の魅力が大きいですよね。価格だけでなく、“備え”と“未来”も含めてより安心できる選択を一緒に考えましょう。」</div>
          <div class="ng"><strong>注意ポイント：</strong><br>・「ネットは危ない」「間違ってる」などと他社否定しない<br>・売り急がない<br>・圧をかけず、選択を尊重</div>
          <div class="mind">心構え：“安さ”ではなく“後悔しない選択”を届ける</div>
        </div>

        <div class="action">
          <h4> 修理訪問の時に信頼を作る <span class="badge">ほっと</span><span class="badge">ずっと</span></h4>
          <ul>
            <li>まず「直せる方法」を真剣に考える</li>
            <li>可能・不可をその場でわかりやすく説明</li>
            <li>無理な交換を勧めない（正直さ）</li>
          </ul>
          <div class="talk"><strong>一言トーク例：</strong><br>「この部品交換であと2〜3年は使えます。交換は急がなくて大丈夫です」</div>
          <div class="ng"><strong>注意ポイント：</strong><br>「今交換しないと危ないです」など不安をあおる言い方</div>
          <div class="mind">💡 心構え：儲けより信頼。次のご依頼は“正直さ”が呼ぶ。</div>
        </div>

        <div class="action">
          <h4> 設備“全体”を診る <span class="badge">わくわく</span><span class="badge">ずっと</span></h4>
          <ul>
            <li>症状だけでなく周辺設備の状態も確認</li>
            <li>将来起こり得る課題を事前にお知らせ</li>
            <li>追加費用が出ないように見積もりは丁寧に</li>
          </ul>
          <div class="talk"><strong>一言トーク例：</strong><br>「今回はここを直します。配管の錆も少し見えるので、次回点検時に確認しましょう」</div>
          <div class="ng"><strong>注意ポイント：</strong><br>断定的な言い切りや過度な不安喚起は避ける。お客様のペースと選択を尊重する。</div>
          <div class="mind">💡 心構え：いま＋未来の安心を同時に届ける。</div>
        </div>

        <div class="action">
          <h4> 緊急対応を最優先にする <span class="badge">ほっと</span></h4>
          <ul>
            <li>大量の水漏れ・トイレ使えないなど緊急性を考慮して段取り</li>
            <li>その場で納期・段取りを提示</li>
            <li>応急処置＋本処置の2段階提案</li>
          </ul>
          <div class="talk"><strong>一言トーク例：</strong><br>「本日は応急的に使える状態にしています。次回いつ訪問出来るかすぐに調べます。」</div>
          <div class="ng"><strong>注意ポイント：</strong><br>緊急度の見極め不足／約束の未連絡をしない。“できない約束”は避ける。</div>
          <div class="mind">💡 心構え：最短で“使える状態”に戻すことを最優先。</div>
        </div>

        <div class="action">
          <h4> 高齢のお客様を大切にする <span class="badge">ほっと</span></h4>
          <ul>
            <li>ゆっくり・ていねい・専門用語は避ける</li>
            <li>ご家族にも説明して安心を共有</li>
            <li>手続き（補助金・管理組合）も代行提案</li>
          </ul>
          <div class="talk"><strong>一言トーク例：</strong><br>「手続きはこちらで準備します。内容の説明書や手続きの控えなどお渡ししますね」</div>
          <div class="ng"><strong>注意ポイント：</strong><br>専門用語の多用や早口は避ける。ご本人の同意や理解がないまま決めない。</div>
          <div class="mind">💡 心構え：相手の歩幅に合わせる。急がず、一緒に。</div>
        </div>

        <div class="action">
          <h4> 生活を想像して提案する <span class="badge">わくわく</span></h4>
          <ul>
            <li>家族構成・使い方・将来の変化をヒアリング</li>
            <li>ショールームで実物確認を案内</li>
            <li>10年後の満足まで見据えたグレード提案</li>
          </ul>
          <div class="talk"><strong>一言トーク例：</strong><br>「お孫さんが遊びに来るなら、この機能があると将来も快適です。実物を一緒に触って確かめましょう」</div>
          <div class="ng"><strong>注意ポイント：</strong><br>お客様の暮らしに合う選択肢を丁寧にご提案。無理なおすすめはしない。</div>
          <div class="mind">💡 心構え：その人の暮らしに、そっと寄り添う選択肢を。</div>
        </div>

        <div class="action">
  <h4> 地域での存在感をつくる <span class="badge">ずっと</span></h4>
  <ul>
    <li>設備や建物の状況、地域特有の注意点を共有</li>
    <li>季節に合わせた暮らしのアドバイス</li>
    <li>過去の対応履歴を踏まえて声かけ</li>
  </ul>
  <div class="talk"><strong>一言トーク例：</strong><br>「近くを回ってますので、出来るだけ早く訪問します」</div>
  <div class="ng"><strong>注意ポイント：</strong><br>・「気づきのおすそわけ」にとどめ、押し付けない<br>・過度に心配させる伝え方はしない<br>・ご家庭のペースやプライバシーを大切に</div>
  <div class="mind">💡 心構え：地域で一番、安心して相談できる存在に。</div>
</div>
      </div>
    </section>

    <!-- 第3章：タイプと接し方 -->
    <section id="ch3">
      <h1>第3章　お客様のタイプと接し方</h1>
      <p class="sub">※誰を選ぶのではなく、「訪問したお客様が何に安心したいか」を見極めるための視点です。</p>
      <div class="type-grid">
        <div class="ctype">
          <h4 class="small"> 安心を重視する方（高齢の方・初めての交換）</h4>
          <ul class="keys">
            <li>落ち着かない様子／対面での相談希望</li>
            <li>「失敗したくない」「よく分からない」が口癖</li>
          </ul>
          <div class="axis"><strong>対応の軸：</strong><br>ゆっくり・ていねい・紙の控え／ご家族にも説明</div>
        </div>

        <div class="ctype">
          <h4> 緊急で困っている方</h4>
          <ul class="keys">
            <li>焦り・切迫／即時の解決希望</li>
            <li>「今日どうにかならない？」がキーワード</li>
          </ul>
          <div class="axis"><strong>対応の軸：</strong><br>最優先で枠確保／応急＋本処置／選択肢は短く</div>
        </div>

        <div class="ctype">
          <h4> マンションにお住まいの方</h4>
          <ul class="keys">
            <li>管理組合への届け出や工事制約が多い</li>
            <li>写真だけでは判断しにくい条件がある</li>
          </ul>
          <div class="axis"><strong>対応の軸：</strong><br>手続き代行・現地確認・近隣配慮の説明を明確に</div>
        </div>

        <div class="ctype">
          <h4> 長く付き合える業者を探している方</h4>
          <ul class="keys">
            <li>「色々な所にお願いするのが面倒」などの話が出る</li>
            <li>点検やメンテナンスへの関心が高い</li>
          </ul>
          <div class="axis"><strong>対応の軸：</strong><br>定期フォローの約束／将来の提案／LINEでの依頼案内</div>
        </div>
      </div>
    </section>

    <footer>
      © Nakasone Jusetsu Co., Ltd. / 現場での使いやすさを最優先に作成（リライト版）
    </footer>
  </div>

  <div class="dock" role="navigation" aria-label="アプリ風ナビ">
    <div class="dock-inner">
      <a class="btn" href="#ch1" data-jump>ナカソネの強み</a>
      <a class="btn" href="#ch2" data-jump>強みを活かす行動</a>
      <a class="btn" href="#ch3" data-jump>タイプ別の接し方</a>
      <a class="btn to-top" href="#" id="toTop">TOP</a>
    </div>
  </div>


  <script>
  (function(){
    const $  = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    // カードにIDを自動採番し、目次用の情報を集める
    function collectCards(){
      const map = { ch1: [], ch2: [], ch3: [] };

      let i = 1;
      $$('#ch1 .value-card').forEach(card => {
        const id = card.id || ('v-' + i++);
        card.id = id;
        const titleEl = card.querySelector('.value-head h2');
        const title = titleEl ? titleEl.textContent.trim() : 'カード';
        map.ch1.push({ id, title });
      });

      i = 1;
      $$('#ch2 .action').forEach(card => {
        const id = card.id || ('a-' + i++);
        card.id = id;
        const titleEl = card.querySelector('h4');
        let raw = titleEl ? titleEl.textContent.trim() : '行動';
        const title = raw.replace(/(ほっと|ずっと|わくわく)/g,'').trim();
        map.ch2.push({ id, title });
      });

      i = 1;
      $$('#ch3 .ctype').forEach(card => {
        const id = card.id || ('c-' + i++);
        card.id = id;
        const titleEl = card.querySelector('h4');
        const title = titleEl ? titleEl.textContent.trim() : 'タイプ';
        map.ch3.push({ id, title });
      });

      return map;
    }

    // 目次の中身を生成
    function buildTOC(map){
      function fill(containerId, items){
        const box = document.getElementById(containerId);
        if(!box) return;
        box.innerHTML = items.map(it => {
          const safe = it.title.replace(/[&<>"]/g, m => (
            { '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m]
          ));
          return '<a href="#' + it.id + '" data-jump>' + safe + '</a>';
        }).join('');
      }
      fill('toc-ch1', map.ch1);
      fill('toc-ch2', map.ch2);
      fill('toc-ch3', map.ch3);
    }

    // a[data-jump] クリックでスムーズスクロール
    function enableSmoothJump(){
      document.addEventListener('click', function(e){
        const a = e.target.closest('a[data-jump]');
        if(!a) return;
        const href = a.getAttribute('href');
        if(!href || href.charAt(0) !== '#') return;
        const target = document.querySelector(href);
        if(!target) return;
        e.preventDefault();
        target.scrollIntoView({ behavior:'smooth', block:'start' });
        history.replaceState(null, '', href);
      });

      const toTop = document.getElementById('toTop');
      if(toTop){
        toTop.addEventListener('click', function(e){
          e.preventDefault();
          window.scrollTo({ top:0, behavior:'smooth' });
          history.replaceState(null, '', '#');
        });
      }
    }

    // 目次の検索バーでカードをフィルタ
    function enableQuickSearch(){
      const input = document.getElementById('quickSearch');
      if(!input) return;
      const cards = [
        ...$$('#ch1 .value-card'),
        ...$$('#ch2 .action'),
        ...$$('#ch3 .ctype'),
      ];
      const cache = new Map(cards.map(el => [el, (el.textContent || '').toLowerCase()]));

      function run(){
        const q = (input.value || '').trim().toLowerCase();
        if(!q){
          cards.forEach(el => el.classList.remove('is-hidden'));
          return;
        }
        const words = q.split(/\s+/).filter(Boolean);
        cards.forEach(el => {
          const text = cache.get(el);
          const ok = words.every(w => text.indexOf(w) !== -1);
          el.classList.toggle('is-hidden', !ok);
        });
      }

      input.addEventListener('input', run);
      input.addEventListener('search', run);
    }

    function init(){
      const map = collectCards();
      buildTOC(map);
      enableSmoothJump();
      enableQuickSearch();
    }

    document.addEventListener('DOMContentLoaded', init);
  })();
  </script>

</body>
</html>
